.model small  
.stack 100h

.data
    MAX_BUFFER_SIZE EQU 200           ; ???????????? ?????? ??????
    buffer db MAX_BUFFER_SIZE dup(0)  ; ????? ??? ???????? 200 ????????

    msgInput db 'Input a string (maximum 200 characters): $' ; ??????? ?????? (???????? 200 ????????)
    msgOutput db 0Dh, 0Ah, 'Modified string: $'            ; ?????????? ??????: 
    msgEnd db 0Dh, 0Ah, 'End of input.$'                    ; ????? ?????.
    msgOverflow db 0Dh, 0Ah, 'Error: buffer overflow.$'      ; ??????: ???????????? ??????.
    strLength db 0                       ; ????? ????????? ??????

.code
main proc
    ; ????????????? ?????????
    mov ax, @data
    mov ds, ax

    ; ????? ????????? ? ?????
    mov dx, offset msgInput
    mov ah, 09h
    int 21h

    ; ???? ?????? ????????
    lea dx, buffer                ; ????????? ?? ?????
    mov byte ptr [buffer], MAX_BUFFER_SIZE ; ???????????? ?????
    mov ah, 0Ah                   ; ??????? ??? ????? ??????
    int 21h

    ; ???????? ???????????? ??????
    mov al, [buffer + 1]           ; ???????? ????? ????????? ?????? (?????? ????)
    cmp al, MAX_BUFFER_SIZE        ; ?????????? ? ???????????? ????????
    ja overflow_error              ; ???? ?????????, ????????? ? ??????
    mov [strLength], al               ; ????????? ?????

    ; ????????? ?????? '$' ? ????? ?????? ??? ??????????? ??????
    lea si, buffer + 2             ; ?????????? ?????? ???? (???????????? ?????) ? ???? ?????
    mov cl, [strLength]               ; ????????? ????? ?????? ? CL
    add si, cx                     ; ????????????? ????????? ?? ????? ??????
    mov byte ptr [si], '$'         ; ????????? '$' ? ????? ??????

    ; ????? ??????? ??????? ??????
    call reverse_string

    ; ??????? ????????? "?????????? ??????:"
    mov dx, offset msgOutput
    mov ah, 09h                    ; ??????? ??? ?????? ??????
    int 21h

    ; ??????? ??????????????? ??????
    lea dx, buffer + 2             ; ????????? ?? ?????? (?????????? 2 ?????)
    mov ah, 09h                    ; ??????? ??? ?????? ??????
    int 21h

    ; ?????????? ?????????
    mov dx, offset msgEnd
    mov ah, 09h
    int 21h

    ; ?????????? ?????????
    mov ax, 4C00h
    int 21h

overflow_error:
    ; ??????? ????????? ?? ?????? ????????????
    mov dx, offset msgOverflow
    mov ah, 09h
    int 21h

    ; ?????????? ?????????
    mov ax, 4C00h
    int 21h

; ??????? ??????? ??????
reverse_string proc
    lea si, buffer + 2            ; ?????? ?????? (?????????? 2 ?????)
    mov cl, [strLength]              ; ????? ?????? ? CL
    dec cl                         ; ?????????????? ??? ?????? ? ?????????
    lea di, buffer + 2            ; ????????? ?? ?????? ??????
    add di, cx                     ; ????????????? ????????? DI ?? ????????? ?????? ??????

reverse_loop:
    ; ???????? ?? ?????????? ??????? (???? SI >= DI)
    cmp si, di
    jge reverse_end

    ; ?????? ??????? ??????? ?? ??????? SI ? DI
    mov al, [si]
    xchg al, [di]
    mov [si], al

    ; ??????? SI ??????, ? DI ?????
    inc si
    dec di
    jmp reverse_loop

reverse_end:
    ret
reverse_string endp

main endp
end main
